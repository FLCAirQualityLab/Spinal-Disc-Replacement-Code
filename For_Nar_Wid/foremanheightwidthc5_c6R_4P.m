%% This code will atempt to find the C5/C6 widening and narrowing of the right handed foreman in flexion (4P)
% in order to find the original length vector, orig coords of the pre model
% must be added to the displacement field output
% in other words... turning the displacement vector into a coordinate vector
clear all

%% Model15_intact/TLC_4P (flexion)
% Width nodes:45870/65936R (R = radialy outwatrd from first node)
T1=[2,2.0675,2.10046,2.15118,2.21847,2.28879,2.30129,2.3542,2.41761,2.47111,2.51624,2.55771,2.60433,2.65123,2.70673,2.75718,2.81828,2.8513,2.91654,2.95737,3];
%65936R
x=-15.4024+[0.0922672,0.101523,0.104626,0.10385,0.109899,0.124311,0.126776,0.136271,0.143989,0.149528,0.15396,0.157496,0.161105,0.164371,0.168034,0.172413,0.177901,0.180733,0.186012,0.189109,0.192253];
y=450.021+[-0.356624,-0.475995,-0.588558,-0.743225,-0.928359,-1.11913,-1.1528,-1.29464,-1.46101,-1.59889,-1.71323,-1.81566,-1.92812,-2.03925,-2.16773,-2.28222,-2.41892,-2.49136,-2.63181,-2.71804,-2.80649];
z=-723.647+[-0.136441,-0.126541,-0.11776,-0.11362,-0.107614,-0.0998667,-0.0987217,-0.0949388,-0.0925737,-0.0911888,-0.0905387,-0.0903207,-0.090476,-0.0909366,-0.091993,-0.0930561,-0.0948504,-0.0960056,-0.0986528,-0.10045,-0.102518];
%45870
X=-9.75965+[0.0977491,0.109082,0.110761,0.109003,0.115369,0.131139,0.133802,0.143736,0.152493,0.159239,0.164613,0.168955,0.173234,0.176942,0.181303,0.186556,0.193306,0.196841,0.20353,0.207666,0.211941];
Y=445.175+[-0.422749,-0.669482,-0.837197,-1.0418,-1.28276,-1.52465,-1.56689,-1.74395,-1.9499,-2.11949,-2.25951,-2.38471,-2.52136,-2.65601,-2.81149,-2.94925,-3.11244,-3.19866,-3.36537,-3.46736,-3.57209];
Z=-723.489+[-0.443259,-0.460266,-0.48039,-0.51729,-0.567749,-0.620449,-0.629932,-0.672637,-0.725848,-0.770363,-0.8075,-0.840999,-0.878035,-0.914858,-0.957797,-0.996145,-1.04198,-1.06642,-1.11433,-1.14377,-1.1741];
LX=[x-X];
LY=[y-Y];
LZ=[z-Z];
% finding L_o vector at Time T=2sec.
L_o=[LX(1,1),LY(1,1),LZ(1,1)];
L=sqrt(LX(1,1)^2+LY(1,1)^2+LZ(1,1)^2);
%OW = total width mag (intact)
K=[LX',LY',LZ'];
I=21;
%magnitude of coordinate vector at each time increment
for n=1:I
    mag15x(n)=sqrt(K(n,1)^2+K(n,2)^2+K(n,3)^2);
end
%narrowing/widening amount
for k=1:I
    widthdisp(k)=-1*[mag15x(1,1)-mag15x(1,k)];
end
% KK(n,1)> K(1,1), therefore widening occured.
figure(2)
plot(T1,widthdisp,'k')
hold on
xlabel('Time (s)')
ylabel({'Foraminal Width/Height Widening (mm)';'(Positive is widening, negative is narrowing)'})
title('Foraminal Width/Height Change for C5-C6 Right Hand Side (4P,flexion')
% Height Nodes:40274U/62517L (U:Upper,L:Lower)
%40274, again... adding original coords on to create coordinate vector
u1=-12.0976+[0.114338,0.127618,0.129607,0.130138,0.13968,0.159386,0.162685,0.175123,0.186372,0.19496,0.201829,0.207642,0.213545,0.218906,0.225144,0.232168,0.240988,0.245595,0.254299,0.259623,0.265095];
u2=446.629+[-0.444623,-0.743019,-0.940934,-1.17868,-1.45701,-1.73779,-1.78697,-1.99337,-2.23464,-2.43412,-2.59916,-2.747,-2.90863,-3.06803,-3.25239,-3.41608,-3.61024,-3.71297,-3.91194,-4.03384,-4.15913];
u3=-721.193+[-0.413199,-0.397557,-0.400093,-0.416375,-0.443739,-0.472641,-0.478029,-0.503897,-0.537932,-0.566966,-0.591527,-0.613812,-0.638753,-0.66385,-0.69352,-0.720212,-0.752583,-0.770051,-0.804762,-0.826327,-0.848745];
%62517
l1=-13.5347+[0.039132,0.0453837,0.0475005,0.045822,0.0484489,0.0564753,0.0578399,0.0630421,0.0667755,0.0694914,0.0716814,0.0732084,0.0746749,0.0758655,0.0771805,0.0791099,0.0817077,0.0830654,0.0855883,0.0870641,0.0886012];
l2=446.999+[-0.268147,-0.345567,-0.421193,-0.525382,-0.65055,-0.779363,-0.802054,-0.897549,-1.00909,-1.10148,-1.17804,-1.24634,-1.32119,-1.39506,-1.48037,-1.55637,-1.64705,-1.69507,-1.78812,-1.84523,-1.90378];
l3=-731.069+[-0.184018,-0.191674,-0.197493,-0.212761,-0.229835,-0.246035,-0.249065,-0.262611,-0.280058,-0.29466,-0.307032,-0.318392,-0.331092,-0.343767,-0.358712,-0.372015,-0.388154,-0.396786,-0.413674,-0.424045,-0.434781];
H1=[u1-l1];
H2=[u2-l2];
H3=[u3-l3];
L_y=[H1(1,1),H2(1,1),H3(1,1)];
%OH = original height magnitude (intact)
OH=sqrt(H1(1,1)^2+H2(1,1)^2+H3(1,1)^2);
T=[H1',H2',H3'];
for n=1:I
    mag15y(n)=sqrt(T(n,1)^2+T(n,2)^2+T(n,3)^2);
end
for n=1:I
    heightdisp(n)=-1*[mag15y(1,1)-mag15y(1,n)];
end
% mag(1,1)< mag(1,n) therefore widening occured.
plot(T1,heightdisp,'b')
%% Now comparing intact model with SlideSlide_Tether model
% model1_SlideSlide_Tether/S2_4P
% Height nodes:40274U/62517L
% adding orig coords to displacement vectors...
%40274U
T2=[2,2.05126,2.11533,2.16533,2.2247,2.26689,2.32627,2.36846,2.42783,2.4542,2.50615,2.55076,2.60453,2.65273,2.70062,2.75176,2.80444,2.85837,2.91342,2.96196,3];
P1=-12.0976+[-0.25429,-0.237789,-0.204636,-0.171026,-0.125183,-0.0833825,-0.0310809,-0.00474252,0.0278573,0.0410924,0.0646571,0.0833916,0.105371,0.12272,0.13791,0.152048,0.164425,0.17577,0.186383,0.195393,0.202124];
P2=446.629+[0.587276,0.422398,0.389728,0.250833,0.0295665,-0.210184,-0.593208,-0.85362,-1.19556,-1.33939,-1.6115,-1.83269,-2.09009,-2.31346,-2.5285,-2.75016,-2.9708,-3.18816,-3.40035,-3.58103,-3.71807];
P3=-721.193+[-0.763545,-0.93433,-0.911533,-0.85263,-0.782825,-0.756158,-0.729663,-0.730275,-0.746678,-0.757121,-0.781744,-0.8051,-0.834563,-0.862567,-0.891129,-0.923304,-0.957773,-0.993484,-1.02953,-1.06081,-1.08488];
% 62517L
M1=-13.5347+[-0.146524,-0.149139,-0.129916,-0.114132,-0.093324,-0.0681055,-0.0410621,-0.0296077,-0.0163936,-0.0112334,-0.00167871,0.00607073,0.0156006,0.0229824,0.0291393,0.0347381,0.0391263,0.0429118,0.0464535,0.049547,0.0518779];
M2=446.999+[0.3466,0.241421,0.272953,0.260911,0.174925,0.0406861,-0.178113,-0.303209,-0.461312,-0.527913,-0.654143,-0.756463,-0.876945,-0.982549,-1.08426,-1.18902,-1.29368,-1.39694,-1.49803,-1.58439,-1.6502];
M3=-731.069+[-0.38589,-0.481655,-0.479846,-0.469337,-0.445116,-0.412951,-0.376385,-0.369777,-0.373904,-0.377991,-0.387941,-0.397678,-0.409222,-0.420175,-0.431462,-0.444463,-0.4592,-0.474566,-0.490187,-0.503744,-0.514182];
% Height i,j,and k
F1=[P1-M1];
F2=[P2-M2];
F3=[P3-M3];
%original height vector FL_y
FL_y=[F1(1,1),F2(1,1),F3(1,1)];
%orignal height magnitude
H1=sqrt(F1(1,1)^2+F2(1,1)^2+F3(1,1)^2);
D=[F1',F2',F3'];
for n=1:I
    mag1y(n)=sqrt(D(n,1)^2+D(n,2)^2+D(n,3)^2);
end
for n=1:I
    heightdisp_model_1(n)=[mag1y(1,1)-mag1y(1,n)];
end
% brief narrowing followed by widenig
hold on
plot(T2,-1*heightdisp_model_1,'-.b')
hold on
%Width nodes:45870/65936R 
%65936R
R1=-15.4024+[-0.16872,-0.1589,-0.132212,-0.11024,-0.0803886,-0.0452477,-0.0123201,0.00241399,0.0222293,0.0301852,0.0458966,0.0592405,0.0755049,0.088501,0.0997932,0.110232,0.119089,0.127224,0.134824,0.14117,0.145789];
R2=450.021+[0.476683,0.306447,0.346773,0.325567,0.198066,0.000415912,-0.319281,-0.501296,-0.73145,-0.828992,-1.014,-1.16419,-1.34112,-1.49636,-1.64624,-1.80086,-1.9557,-2.10906,-2.2594,-2.38789,-2.48581];
R3=-723.647+[-0.447071,-0.5126,-0.512288,-0.495996,-0.451944,-0.391382,-0.313455,-0.284239,-0.259886,-0.252002,-0.239417,-0.23105,-0.221657,-0.214676,-0.208992,-0.204902,-0.202895,-0.201939,-0.201915,-0.202419,-0.203118];
%45870
E1=-9.75965+[-0.240195,-0.230542,-0.200404,-0.170491,-0.130409,-0.0918666,-0.0425626,-0.0183674,0.0102586,0.0217032,0.0417192,0.0572858,0.0756614,0.0901233,0.102554,0.113931,0.12359,0.132319,0.140456,0.147477,0.152786];
E2=445.175+[0.513202,0.376698,0.36564,0.263555,0.0887322,-0.119583,-0.453406,-0.679446,-0.976114,-1.1007,-1.33626,-1.52746,-1.74958,-1.94193,-2.12676,-2.31679,-2.50554,-2.691,-2.87159,-3.02504,-3.14118];
E3=-723.489+[-0.700086,-0.897319,-0.891991,-0.860318,-0.824727,-0.819795,-0.824012,-0.845289,-0.889007,-0.910814,-0.956611,-0.99704,-1.04587,-1.09011,-1.13398,-1.18158,-1.23106,-1.28121,-1.331,-1.37365,-1.40611];
S1=[R1-E1];
S2=[R2-E2];
S3=[R3-E3];
%original width vector
SL_o=[S1(1,1),S2(1,1),S3(1,1)];
%original width magnitude
W1=sqrt(S1(1,1)^2+S2(1,1)^2+S3(1,1)^2);
RE=[S1',S2',S3'];
for n=1:I
    mag1x(n)=sqrt(RE(n,1)^2+RE(n,2)^2+RE(n,3)^2);
end
for n=1:I
    widthdisp_model_1(n)=[mag1x(1,1)-mag1x(1,n)];
end
% magRE(1,1) > magRE(1,2) therefore narrowing occured initially. magRE(1,1) <
% magRE(1,2+n) therefore widening followed.
plot(T2,-1*widthdisp_model_1,'-.k')
%% model2_SlideSlide_NoTether
% 40274U
T3=[2,2.05126,2.11533,2.16533,2.2247,2.26689,2.31689,2.36689,2.42627,2.46846,2.52783,2.57002,2.60127,2.65098,2.70667,2.75577,2.81523,2.85038,2.90628,2.96349,3];
NO1=-12.0976+[-0.216935,-0.219594,-0.220827,-0.222313,-0.214947,-0.209092,-0.192667,-0.171476,-0.14615,-0.126266,-0.0982627,-0.0798557,-0.0664225,-0.0445167,-0.0192818,0.00316437,0.0299394,0.0451846,0.0680055,0.0890525,0.101285];
NO2=446.629+[0.634728,0.600968,0.645819,0.710014,0.730795,0.723817,0.667945,0.554818,0.384915,0.238168,0.0111837,-0.17075,-0.309885,-0.533823,-0.776484,-0.990533,-1.25163,-1.40675,-1.65411,-1.90699,-2.06853];
NO3=-721.193+[-0.843751,-0.934578,-0.96555,-0.977104,-0.948708,-0.910977,-0.880474,-0.863579,-0.841762,-0.823494,-0.796549,-0.779631,-0.768557,-0.75963,-0.763469,-0.772631,-0.787613,-0.797886,-0.816818,-0.839269,-0.855166];
% 62517L
UU1=-13.5347+[-0.133322,-0.138553,-0.137773,-0.135838,-0.130561,-0.129815,-0.122086,-0.110588,-0.097191,-0.0865358,-0.0734931,-0.065312,-0.0588368,-0.0478571,-0.0364024,-0.026437,-0.0147183,-0.00820354,0.00136676,0.0098161,0.0145524];
UU2=446.999+[0.337083,0.313597,0.362971,0.43042,0.508574,0.543758,0.536879,0.478424,0.387385,0.307599,0.182108,0.0812269,0.0061486,-0.104807,-0.215017,-0.311959,-0.430008,-0.500505,-0.613792,-0.730925,-0.806833];
UU3=-731.069+[-0.419405,-0.472948,-0.498392,-0.515428,-0.52834,-0.537605,-0.532867,-0.516491,-0.49351,-0.472811,-0.442763,-0.4234,-0.410202,-0.397855,-0.396185,-0.397886,-0.401875,-0.404952,-0.411185,-0.419019,-0.425027];
JI1=[NO1-UU1];
JI2=[NO2-UU2];
JI3=[NO3-UU3];
%original height vecotr
JIL_y=[JI1(1,1),JI2(1,1),JI3(1,1)];
%original height magnitude
H2=sqrt(JI1(1,1)^2+JI2(1,1)^2+JI3(1,1)^2);
MJ=[JI1',JI2',JI3'];
for n=1:I
    mag2y(n)=[sqrt(MJ(n,1)^2+MJ(n,2)^2+MJ(n,3)^2)];
end
for n=1:I
    heightdisp_model_2(n)=[mag2y(1,1)-mag2y(1,n)];
end
% relatively small widening and narrowing followed by larger than intact
% wideing
hold on
plot(T3,-1*heightdisp_model_2,'-b*')
hold on
% 65936R
FG1=-15.4024+[-0.146192,-0.148656,-0.147388,-0.146329,-0.140446,-0.140381,-0.129446,-0.113737,-0.0972077,-0.0848027,-0.0705525,-0.0624076,-0.0541953,-0.0379345,-0.0201544,-0.00447358,0.0142209,0.0248024,0.0407521,0.0553466,0.0636842];
FG2=450.021+[0.458229,0.41232,0.474173,0.563204,0.665374,0.70919,0.692849,0.60288,0.462361,0.338728,0.145147,-0.00806869,-0.120427,-0.283585,-0.446579,-0.590636,-0.765912,-0.870436,-1.03811,-1.21114,-1.32288];
FG3=-723.647+[-0.474687,-0.518203,-0.548715,-0.575019,-0.597762,-0.610736,-0.600793,-0.569578,-0.524644,-0.485133,-0.426905,-0.386627,-0.35837,-0.324597,-0.30143,-0.284295,-0.265858,-0.255862,-0.241601,-0.228945,-0.222147];
% 45870
PL1=-9.75965+[-0.206648,-0.211863,-0.213984,-0.215492,-0.209093,-0.205598,-0.190274,-0.169882,-0.14609,-0.127383,-0.100908,-0.0833631,-0.0708702,-0.0513159,-0.0293792,-0.009951,0.0131782,0.0262984,0.0457921,0.0633898,0.073463];
PL2=445.175+[0.556323,0.533101,0.584598,0.654208,0.697962,0.712144,0.68112,0.590725,0.450209,0.327089,0.135648,-0.0190972,-0.13816,-0.331072,-0.539691,-0.723681,-0.948106,-1.08147,-1.29425,-1.51187,-1.65099];
PL3=-723.489+[-0.781326,-0.882136,-0.918683,-0.93401,-0.921846,-0.90032,-0.886723,-0.884764,-0.882272,-0.879099,-0.873996,-0.872995,-0.873707,-0.883426,-0.907789,-0.934635,-0.970485,-0.992767,-1.03023,-1.07099,-1.09818];
KO1=[FG1-PL1];
KO2=[FG2-PL2];
KO3=[FG3-PL3];
% original width distance vector
KOO=[KO1(1,1),KO2(1,1),KO3(1,1)];
%orinal width distance magnitude
W2=sqrt(KO1(1,1)^2+KO2(1,1)^2+KO3(1,1)^2);
KLK=[KO1',KO2',KO3'];
for n=1:I
    mag2x(n)=[sqrt(KLK(n,1)^2+KLK(n,2)^2+KLK(n,3)^2)];
end
for n=1:I
    widthdisp_model_2(n)=mag2x(1,1)-mag2x(1,n);
end
plot(T3,-1*widthdisp_model_2,'-k*')
%% Model3_APSlide_Tether
T4=[2,2.05126,2.11533,2.16533,2.2247,2.26689,2.31689,2.36689,2.42627,2.45263,2.51196,2.57134,2.62143,2.65745,2.70443,2.7639,2.80111,2.85094,2.90531,2.96081,3];
% 40274U
AA1=-12.0976+[-0.10941,-0.107544,-0.109956,-0.116153,-0.117082,-0.114139,-0.106618,-0.094407,-0.0783109,-0.07122,-0.0545303,-0.0380133,-0.0249984,-0.016562,-0.00561561,0.0101696,0.0210359,0.0360743,0.0527894,0.0696631,0.0812896];
AA2=446.629+[0.2715,0.279394,0.367029,0.469913,0.559877,0.601314,0.627799,0.599045,0.526169,0.481718,0.356243,0.20719,0.0627401,-0.049326,-0.205615,-0.415672,-0.549182,-0.728593,-0.927362,-1.13463,-1.28341];
AA3=-721.193+[-0.803596,-0.821245,-0.85214,-0.877548,-0.87575,-0.855238,-0.829379,-0.822111,-0.813525,-0.808424,-0.79421,-0.777949,-0.763099,-0.75183,-0.739479,-0.731576,-0.732712,-0.738416,-0.747856,-0.760131,-0.76996];
% 62517L
AB1=-13.5347+[-0.0902587,-0.0893624,-0.0878393,-0.0879134,-0.0850876,-0.0840229,-0.0807982,-0.0735714,-0.0636964,-0.0593647,-0.0504357,-0.0431807,-0.0377374,-0.0345126,-0.029509,-0.0211941,-0.0160177,-0.00914998,-0.00170739,0.00561947,0.0105516];
AB2=446.999+[0.117153,0.121432,0.18971,0.270188,0.37508,0.438076,0.491251,0.487121,0.452723,0.430998,0.366896,0.288057,0.211249,0.153519,0.0745592,-0.0282493,-0.0884334,-0.167501,-0.254099,-0.344701,-0.410345];
AB3=-731.069+[-0.391968,-0.400618,-0.420923,-0.441599,-0.460959,-0.474116,-0.483582,-0.479561,-0.469092,-0.463393,-0.447269,-0.4295,-0.413152,-0.400844,-0.38687,-0.375876,-0.374368,-0.375171,-0.378194,-0.382595,-0.38626];
VAB1=[AA1-AB1];
VAB2=[AA2-AB2];
VAB3=[AA3-AB3];
%original height vector
VAB=[VAB1(1,1),VAB2(1,1),VAB3(1,1)];
%orignal magnitude
H3=sqrt(VAB1(1,1)^2+VAB2(1,1)^2+VAB3(1,1)^2);
Array3V=[VAB1',VAB2',VAB3'];
for n=1:I
    mag3y(n)=[sqrt(Array3V(n,1)^2+Array3V(n,2)^2+Array3V(n,3)^2)];
end
for n=1:I
    heightdisp_model_3(n)=mag3y(1,1)-mag3y(1,n);
end
plot(T4,-1*heightdisp_model_3,'-+b')
hold on
% 65936R
AC1=-15.4024+[-0.0732179,-0.0713393,-0.0709566,-0.073324,-0.0713006,-0.0712675,-0.0676935,-0.0588465,-0.0472584,-0.0426451,-0.0341975,-0.0284366,-0.0246747,-0.0223494,-0.0160615,-0.00380686,0.00428898,0.0151851,0.0270927,0.0391197,0.047404];
AC2=450.021+[0.151083,0.154284,0.244029,0.351274,0.49095,0.573538,0.641329,0.626966,0.567009,0.530275,0.424016,0.296354,0.173197,0.0802566,-0.043067,-0.199489,-0.289974,-0.40967,-0.541223,-0.678697,-0.777995];
AC3=-723.647+[-0.403272,-0.411219,-0.44058,-0.472897,-0.506867,-0.528459,-0.543842,-0.534756,-0.512709,-0.500488,-0.466621,-0.428932,-0.39412,-0.367952,-0.336185,-0.303495,-0.289736,-0.274312,-0.259676,-0.245989,-0.236881];
% 45870
AD1=-9.75965+[-0.113025,-0.111832,-0.113857,-0.119276,-0.120165,-0.118192,-0.111432,-0.0991998,-0.0831865,-0.0764294,-0.0605176,-0.0446284,-0.0319774,-0.0238468,-0.0138742,-0.000170769,0.00917064,0.0220106,0.0362044,0.0504081,0.0600999];
AD2=445.175+[0.238072,0.248526,0.336256,0.438099,0.539652,0.59617,0.643086,0.630534,0.578452,0.544029,0.44384,0.322621,0.20367,0.110802,-0.0204237,-0.199094,-0.313039,-0.465963,-0.635335,-0.8122,-0.939379];
AD3=-723.489+[-0.785743,-0.805814,-0.836501,-0.86055,-0.866261,-0.856435,-0.844221,-0.846995,-0.851183,-0.852437,-0.853911,-0.854259,-0.854032,-0.853565,-0.855577,-0.86601,-0.878514,-0.899401,-0.925321,-0.95422,-0.975596];
VCD1=[AC1-AD1];
VCD2=[AC2-AD2];
VCD3=[AC3-AD3];
Array3H=[VCD1',VCD2',VCD3'];
for n=1:I
    mag3x(n)=sqrt(Array3H(n,1)^2+Array3H(n,2)^2+Array3H(n,3)^2);
end
for n=1:I
    widthdisp_model_3(n)=mag3x(1,1)-mag3x(1,n);
end
plot(T4,-1*widthdisp_model_3,'-+k')
legend('width intact','height intact','model 1 height','model 1 width ','model 2 height','model 2 width','model 3 height','model 3 width','location','northwest')

