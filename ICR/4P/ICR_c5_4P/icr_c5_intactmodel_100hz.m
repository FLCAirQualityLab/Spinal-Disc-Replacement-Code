%% This code shows ICR for the C5 vertabrae for Model15_Intact/TLC_4P
% To obtain a single graph and legend for all models,start with intactmodel and run each model within
% the file.
k=63;
% anterior node: 48025
%original coords
%aa1=.690084
aa2=433.003+[0.0426379 0.0060885 -0.0275168 -0.0821287 -0.188121 -0.301444 -0.394684 -0.452118 -0.505467 -0.576705 -0.641677 -0.701569 -0.78051 -0.852012 -0.919073 -0.943626 -0.979516 -1.03165 -1.05082 -1.08471 -1.1086 -1.14402 -1.1958 -1.21493 -1.24316 -1.28452 -1.3446 -1.36671 -1.39946 -1.44755 -1.46531 -1.4915 -1.51565 -1.53701 -1.56848 -1.59765 -1.60417 -1.62841 -1.64993 -1.6699 -1.68765 -1.71374 -1.72344 -1.73786 -1.75915 -1.79041 -1.80201 -1.81925 -1.84477 -1.85427 -1.86836 -1.88918 -1.91976 -1.93109 -1.9479 -1.97267 -1.98188 -1.99556 -2.01575 -2.04538 -2.05638 -2.07268 -2.09322];
aa3=-728.01+[-0.26043 -0.312938 -0.360095 -0.436502 -0.573977 -0.720744 -0.869633 -0.958706 -1.03085 -1.13074 -1.22075 -1.30325 -1.41813 -1.52865 -1.63722 -1.67766 -1.73764 -1.82625 -1.85944 -1.91861 -1.96072 -2.02405 -2.11841 -2.15368 -2.2064 -2.28487 -2.40137 -2.4447 -2.50936 -2.60554 -2.64139 -2.69475 -2.74438 -2.78869 -2.85456 -2.91586 -2.9296 -2.98085 -3.02669 -3.06941 -3.10764 -3.16448 -3.18569 -3.21743 -3.26483 -3.33521 -3.36147 -3.40068 -3.45905 -3.48085 -3.51335 -3.56168 -3.63356 -3.66043 -3.70049 -3.76009 -3.78237 -3.81564 -3.86517 -3.93857 -3.96588 -4.00664 -4.05833 ];
% posterior node: 49541
% original coords.
%ab1=1.05125
ab2=448.452+[0.0901372 0.0492133 0.0105402 -0.0533435 -0.177863 -0.312847 -0.430347 -0.502988 -0.568485 -0.656507 -0.736568 -0.810451 -0.909465 -1.00073 -1.08779 -1.11997 -1.16734 -1.23684 -1.26262 -1.30842 -1.34091 -1.38946 -1.46126 -1.48804 -1.52785 -1.5868 -1.67378 -1.70615 -1.75444 -1.8261 -1.8528 -1.89246 -1.92932 -1.96217 -2.01097 -2.05653 -2.06676 -2.10494 -2.13909 -2.17097 -2.19948 -2.24176 -2.25755 -2.28114 -2.31621 -2.36822 -2.38766 -2.41667 -2.45989 -2.47607 -2.50016 -2.536 -2.58924 -2.60913 -2.6388 -2.68291 -2.69942 -2.72406 -2.76072 -2.81514 -2.83547 -2.86577 -2.90428];
ab3=-726.226+[-0.682486 -0.684303 -0.676093 -0.657269 -0.620927 -0.585218 -0.548501 -0.529426 -0.518997 -0.50945 -0.505391 -0.503766 -0.502558 -0.503491 -0.505375 -0.506178 -0.507507 -0.509602 -0.510523 -0.512377 -0.51378 -0.516019 -0.519369 -0.520559 -0.522324 -0.524776 -0.528259 -0.529481 -0.531273 -0.534194 -0.535273 -0.536877 -0.538342 -0.539658 -0.541585 -0.543383 -0.543784 -0.5453 -0.54664 -0.547868 -0.548955 -0.550573 -0.551169 -0.552105 -0.553641 -0.555914 -0.556753 -0.558048 -0.559996 -0.560739 -0.561837 -0.563444 -0.565818 -0.566703 -0.568029 -0.569989 -0.570717 -0.57182 -0.573399 -0.575612 -0.576432 -0.577654 -0.579151 ];

for n=2:k
ua2(n-1)=[aa2(n)-aa2(n-1)];
ua3(n-1)=[aa3(n)-aa3(n-1)];
ub2(n-1)=[ab2(n)-ab2(n-1)];
ub3(n-1)=[ab3(n)-ab3(n-1)];
end

% U(n)• R(n)=0, R(n)=y,z assuming z=-1, y=-ua3/ua2
 for n=1:k-1
    ya1(n)=ua3(n)/ua2(n);
    yb1(n)=ub3(n)/ub2(n);
 end
 %r1,r2 are the perendicular vectors to the displacement vector.
%  i=-1*ones(size(ya1))';
%  r1=[ya1',i];
%  r2=[yb1',i];

t=linspace(0,30.0681,10000);
T=linspace(0,1,10000);

%% 0-2 Nm
figure (2)
for n=2:k-1
m1=[ya1(n), -yb1(n);-1, 1];
m2=[ab2(n)+.5*ub2(n)-aa2(n)-.5*ua2(n);ab3(n)+.5*ub3(n)-aa3(n)-.5*ua3(n)];
c=m1\m2;


t=linspace(0,c(2,1),100);
t2=linspace(0,c(1,1),100);

ra2=aa2(n)+.5*ua2(n)+t2*ya1(n);
ra3=aa3(n)+.5*ua3(n)-t2;


plot(ra2,ra3,'g')
hold on

j1=aa2(n)+T*ua2(n);
k1=aa3(n)+T*ua3(n);
plot(j1,k1,'c')
hold on

rb2=ab2(n)+.5*ub2(n)+t*yb1(n);
rb3=ab3(n)+.5*ub3(n)-t;
plot(rb2,rb3,'g')
hold on

j2=ab2(n)+T*ub2(n);
k2=ab3(n)+T*ub3(n);
plot(j2,k2,'c')

point1(n)=[rb2(1,100)];
point2(n)=[rb3(1,100)];

end

hold on
point3=point1(1,2:62);
point4=point2(1,2:62);
plot(point3,point4,'ob');

title('ICR of C5 vertabra - Intact model  under flexion (4P)')
xlabel('y-coords (mm)')
ylabel('z-coords (mm)')

figure(1)
% ca=plot(point3,point4,'ok');
% hold on
xlabel('y-coords (mm)')
ylabel('z-coords (mm)')
ca=animatedline('color','b','marker','x');
for n=1:1:k-2
addpoints(ca,point3(n),point4(n));
drawnow
end